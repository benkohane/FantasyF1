{% extends "base.html" %}

{% block title %}Full Data{% endblock %}

{% block content %}
<div class="text-center mb-8">
  <h2 class="text-3xl font-semibold text-gray-100">Player Overview & Scores</h2>
  <p class="text-gray-400 mt-2">This page shows a detailed breakdown of each player's selections and their total points across all races.</p>
</div>

<!-- Filters -->
<div class="flex justify-center mb-8">
  <select id="filter-username" class="bg-gray-800 text-gray-300 border border-gray-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2">
    <option value="">Filter by Player</option>
    {% for username in user_data.keys() %}
      <option value="{{ username }}">{{ username }}</option>
    {% endfor %}
  </select>
</div>

<!-- Score Table -->
<div class="overflow-x-auto bg-gray-800 rounded-lg shadow-lg">
  <table class="min-w-full table-auto text-sm text-gray-300">
    <thead class="bg-gray-700">
      <tr>
        <th class="px-4 py-2 text-left">Username</th>
        <th class="px-4 py-2 text-left">Race Round</th>
        <th class="px-4 py-2 text-left">Selected Driver</th>
        <th class="px-4 py-2 text-left">Points</th>
        <th class="px-4 py-2 text-left">Total Points</th>
      </tr>
    </thead>
    <tbody>
      {% for username, data in user_data.items() %}
        {% for selection in data.selections %}
          <tr class="hover:bg-gray-700" data-username="{{ username }}">
            {% if loop.first %}
              <td rowspan="{{ data.selections|length }}" class="font-semibold">{{ username }}</td>
            {% endif %}
            <td>{{ selection.race_round }}</td>
            <td>{{ selection.selected_driver }}</td>
            <td>{{ selection.points if selection.points is not none else 'N/A' }}</td>
            {% if loop.first %}
              <td rowspan="{{ data.selections|length }}" class="font-semibold">{{ data.total_points }}</td>
            {% endif %}
          </tr>
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const filterUsername = document.getElementById('filter-username');
    const rows = document.querySelectorAll('tbody tr');

    // Add event listener for username filter
    filterUsername.addEventListener('change', filterRows);

    // Function to filter rows based on username
    function filterRows() {
      const usernameFilter = filterUsername.value;

      rows.forEach(row => {
        const usernameCell = row.dataset.username;

        // If username matches the filter, show the row, otherwise hide it
        if (usernameFilter && usernameCell !== usernameFilter) {
          row.style.display = 'none';
        } else {
          row.style.display = '';
        }
      });
    }
  });
</script>

{% endblock %}
